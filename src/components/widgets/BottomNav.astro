---
import { Icon } from 'astro-icon/components';
import { trimSlash } from '~/utils/permalinks';

const currentPath = `/${trimSlash(new URL(Astro.url).pathname)}`;

const navItems = [
  { text: 'บ้าน', href: '/', icon: 'tabler:home' },
  { text: 'สินค้า', href: '/#products', icon: 'tabler:shopping-bag' },
  { text: 'ความรู้', href: '/article', icon: 'tabler:book' },
  { 
    text: 'โทร', 
    href: 'tel:0816119016', 
    icon: 'tabler:phone',
    // ใช้รหัสเฉพาะสำหรับการโทร
    onclick: "return gtag_report_conversion_call('tel:0816119016')"
  },
  { 
    text: 'Line', 
    href: 'https://line.me/ti/p/~@grainsure#~', 
    icon: 'tabler:message-circle-2',
    // ใช้รหัสเฉพาะสำหรับ Line
    onclick: "return gtag_report_conversion_line('https://line.me/ti/p/~@grainsure#~')"
  },
];
---

<nav class="md:hidden fixed bottom-0 left-0 z-50 w-full bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
  <div class="grid h-full max-w-lg grid-cols-5 mx-auto">
    
    {navItems.map((item) => {
      const isActive = item.href === '/' 
        ? currentPath === '/' 
        : currentPath.startsWith(item.href);

      const colorClass = isActive 
        ? 'text-green-600' 
        : 'text-gray-500 hover:text-green-600';

      return (
        <a 
          href={item.href} 
          target={item.text === 'Line' ? '_blank' : '_self'}
          onclick={item.onclick ? item.onclick : null}
          class="inline-flex flex-col items-center justify-center px-5 py-3 group transition-colors bg-white"
        >
          <Icon name={item.icon} class={`w-6 h-6 mb-1 ${colorClass}`} />
          <span class={`text-[11px] font-medium ${colorClass}`}>{item.text}</span>
        </a>
      );
    })}

  </div>
</nav>

<script is:inline>
  // ฟังก์ชันสำหรับวัดผลการโทร
  function gtag_report_conversion_call(url) {
    var callback = function () {
      if (typeof(url) != 'undefined') {
        window.location = url;
      }
    };
    gtag('event', 'conversion', {
        'send_to': 'AW-17371749507/eYarCJ_TwOcbEIO5v9tA',
        'value': 1.0,
        'currency': 'THB',
        'event_callback': callback
    });
    return false;
  }

  // ฟังก์ชันสำหรับวัดผล Line
  function gtag_report_conversion_line(url) {
    var callback = function () {
      if (typeof(url) != 'undefined') {
        window.location = url;
      }
    };
    gtag('event', 'conversion', {
        'send_to': 'AW-17371749507/RARzCLzn4ucbEIO5v9tA',
        'value': 1.0,
        'currency': 'THB',
        'event_callback': callback
    });
    return false;
  }
</script>